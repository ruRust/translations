---
layout: post
title: 'Rust 1.62.0: `cargo add`, `#[default]` для перечислений, быстрые мьютексы на Linux и поддержка baremetal x86_64 платформы'
author: The Rust Release Team
release: 'true'
---

Команда Rust рада сообщить о новой версии языка — 1.62.0. Rust — это язык программирования, позволяющий каждому создавать надёжное и эффективное программное обеспечение.

Если у вас есть предыдущая версия Rust, установленная через `rustup`, то для обновления до версии 1.62.0 вам достаточно выполнить команду:

```console
rustup update stable
```

Если у вас ещё нет `rustup`, то можете установить его со [страницы](https://www.rust-lang.org/install.html) на нашем веб-сайте, а также ознакомиться с [подробным описанием выпуска 1.62.0](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1620-2022-06-30) на GitHub.

Если вы хотите помочь нам протестировать будущие выпуски, вы можете использовать beta (`rustup default beta`) или nightly (`rustup default nightly`) канал. Пожалуйста, [сообщайте](https://github.com/rust-lang/rust/issues/new/choose) обо всех встреченных вами ошибках.

## Что стабилизировано в 1.62.0

### `cargo add`

You can now add new dependencies directly from the command line using `cargo add`. This command supports specifying features and versions. It can also be used to modify existing dependencies.

Например:

```text
cargo add log
cargo add serde --features derive
cargo add nom@5
```

See the [cargo documentation](https://doc.rust-lang.org/nightly/cargo/commands/cargo-add.html) for more.

### `#[default]` enum variants

You can now use `#[derive(Default)]` on enums if you specify a default variant. For example, until now you would have to manually write a `Default` impl for this enum:

```rust
#[derive(Default)]
enum Maybe<T> {
    #[default]
    Nothing,

    Something(T),
}
```

As of now only "unit" variants (variants that have no fields) are allowed to be marked `#[default]`. More information is available in the [RFC](https://rust-lang.github.io/rfcs/3107-derive-default-enum.html) for this feature.

### Thinner, faster mutexes on Linux

Previously, `Mutex`, `Condvar`, and `RwLock` were backed by the pthreads library on Linux. The pthreads locks support more features than the Rust APIs themselves do, including runtime configuration, and are designed to be used in languages with fewer static guarantees than Rust provides.

The mutex implementation, for example, is 40 bytes and cannot be moved. This forced the standard library to allocate a `Box` behind the scenes for each new mutex for platforms that use pthreads.

Rust's standard library now ships with a raw futex-based implementation of these locks on Linux, which is very lightweight and doesn't require extra allocation. In 1.62.0 `Mutex` only needs 5 bytes for its internal state on Linux, though this may change in future versions.

This is part of a long effort to improve the efficiency of Rust's lock types, which includes previous improvements on Windows such as unboxing its primitives. You can read more about that effort in the [tracking issue](https://github.com/rust-lang/rust/issues/93740).

### Bare metal `x86_64` target

It's now easier to build OS-less binaries for `x86_64`, for example when writing a kernel. The [`x86_64-unknown-none` target](https://doc.rust-lang.org/beta/rustc/platform-support/x86_64-unknown-none.html) has been promoted to [Tier 2](https://doc.rust-lang.org/rustc/platform-support.html#tier-2) and can be installed with rustup.

```console
rustup target add x86_64-unknown-none
rustc --target x86_64-unknown-none my_no_std_program.rs
```

You can read more about development using `no_std` in the [Embedded Rust book](https://docs.rust-embedded.org/book/intro/no-std.html).

### Стабилизированные API

Стабилизированы следующие методы и реализации типажей:

- [`bool::then_some`](https://doc.rust-lang.org/stable/std/primitive.bool.html#method.then_some)
- [`f32::total_cmp`](https://doc.rust-lang.org/stable/std/primitive.f32.html#method.total_cmp)
- [`f64::total_cmp`](https://doc.rust-lang.org/stable/std/primitive.f64.html#method.total_cmp)
- [`Stdin::lines`](https://doc.rust-lang.org/stable/std/io/struct.Stdin.html#method.lines)
- [`windows::CommandExt::raw_arg`](https://doc.rust-lang.org/stable/std/os/windows/process/trait.CommandExt.html#tymethod.raw_arg)
- [`impl<T: Default> Default for AssertUnwindSafe<T>`](https://doc.rust-lang.org/stable/std/panic/struct.AssertUnwindSafe.html#impl-Default)
- [`From<Rc<str>> for Rc<[u8]>`](https://doc.rust-lang.org/stable/std/rc/struct.Rc.html#impl-From%3CRc%3Cstr%3E%3E)
- [`From<Arc<str>> for Arc<[u8]>`](https://doc.rust-lang.org/stable/std/sync/struct.Arc.html#impl-From%3CArc%3Cstr%3E%3E)
- [`FusedIterator for EncodeWide`](https://doc.rust-lang.org/stable/std/os/windows/ffi/struct.EncodeWide.html#impl-FusedIterator)
- [RDM intrinsics для aarch64](https://github.com/rust-lang/stdarch/pull/1285)

### Прочие изменения

В выпуске Rust 1.62.0 есть и другие изменения: узнайте, что изменилось в [Rust](https://github.com/rust-lang/rust/blob/stable/RELEASES.md#version-1620-2022-06-30), [Cargo](https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-162-2022-06-30) и [Clippy](https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-162).

### Участники 1.62.0

Многие люди собрались вместе, чтобы создать Rust 1.62.0. Без вас мы бы не справились. [Спасибо!](https://thanks.rust-lang.org/rust/1.62.0/)
